# API

Untuk berinteraksi dengan sebuah API, aplikasi flutter membutuhkan package pihak ketiga `http`

>flutter pub add http

## Async

Dalam flutter, sebuah tipe data yang didapatkan dari proses async, adalah tipe `Future`. Jika kita ingin agar fungsi async ditunggu sebelum mengeksekusi baris lain, ada 2 cara:

- .then()
- tandai fungsi sebagai `async` dan tambahkan keyword `await` proses async pada statement async tersebut.

## Parsing API Response

Untuk parsing response, gunakan `json` utility obj.

```dart
final data = json.decode(response.body);

// 1. Manual
for(final item in data.entries){
    // item.value
    // item.key
}

// 2. Menggunakan model
class User {
  final int id;
  final String name;
  final String email;

  User({
    required this.id,
    required this.name,
    required this.email,
  });

  // Dari JSON → ke Object
  factory User.fromJson(Map<String, dynamic> json) {
    return User(
      id: json['id'],
      name: json['name'],
      email: json['email'],
    );
  }

  // Dari Object → ke JSON
  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'name': name,
      'email': email,
    };
  }
}

return User.fromJson(data);
```

### Class over Typedef

Penggunaan Model dalam parsing API, sering dilakukan menggunakan class daripada `typedef`. Hal ini dikarenakan beberapa hal:

- Bisa punya method (fromJson, toJson, copyWith, dll).
- Bisa punya nested object (misal User punya List`<Post>`).
- Lebih mudah diintegrasikan dengan code generator (json_serializable, freezed).
- Bisa menambahkan validasi, default value, atau logic tambahan.

## Updating Component

Ketika menggunakan `context` pada fungsi async, lakukan pengecekan (siapa tau proses masih berjalan ketika kita sudah pindah halaman dan referensi context hilang)

```dart
onPressed: () async {
  await Future.delayed(Duration(seconds: 3));

  // pengecekan
  if (!context.mounted) return;
  
  Navigator.push(
    context,
    MaterialPageRoute(builder: (_) => NextPage()),
  );
}
```
